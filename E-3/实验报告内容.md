# 数据可视化实验报告内容

## 1 实验概述

### 1.1 实验名称
设计一个数据可视化作品，讲述数据的故事。

### 1.2 实验目的
（1）了解数据可视化方案的设计和实现方法；
（2）利用python的数据可视化工具库（matplotlib库、pyecharts库等）进行可视化方案的实现。

### 1.3 实验环境
软件：python 3.x
可用库：数据处理库NumPy、pandas；可视化库pyecharts库。

### 1.4 实验内容
（1）在备选的4个数据集中选择世界杯数据集，对数据集中的数据进行数据分析和预处理，设计合理的可视化方案。
（2）利用python的可视化工具库实现可视化方案。
（3）完成实验报告，讲述数据的故事。

### 1.5 实验要求
（1）对数据集中的数据进行分析和整理，提取出其中的有效信息，完成数据的预处理；
（2）设计合理的可视化视图，选择合适的视觉通道，表达数据的某个特性；
（3）完成不少于6个可视化视图，较为完整地描述数据集。

---

## 2 总体设计

### 2.1 总体设计思路
本实验选择世界杯数据集进行分析。该数据集包含1930年至2018年共21届世界杯的完整数据，包括：
- WorldCupsSummary.csv：21届世界杯的汇总信息，包含年份、主办国、前四名队伍、总进球数、参赛队伍数、比赛场次、观众人数、主办洲、冠军洲等字段，共22条记录（包含表头）。
- WorldCupMatches.csv：所有单场比赛的详细信息，包含比赛时间、主客队、比分、裁判等信息，共852条记录。
- WorldCupPlayers.csv：球员信息表，包含球员姓名、位置、比赛事件等信息。

数据集特点：
- 时间跨度长：从1930年到2018年，跨越88年
- 数据维度丰富：包含时间、地理、队伍表现、比赛数据等多个维度
- 故事性强：可以展现世界杯历史发展、各队实力变化、比赛趋势等

### 2.2 总体设计框架
总体设计框架如下：

```
数据加载
    ↓
数据预处理（缺失值处理、数据计算、统计汇总）
    ↓
可视化视图设计
    ├─ 视图1：历届世界杯总进球数趋势（折线图）
    ├─ 视图2：各洲举办世界杯次数（饼图）
    ├─ 视图3：各洲获得冠军次数（柱状图）
    ├─ 视图4：历届世界杯观众人数变化（折线图）
    ├─ 视图5：参赛队伍数量变化（柱状图）
    ├─ 视图6：各队进入前四名次数（条形图）
    ├─ 视图7：历届世界杯场均进球数（折线图）
    └─ 视图8：各队获得冠军次数（柱状图）
    ↓
视图输出（HTML格式）
```

主要设计内容：
1. **数据预处理**：处理缺失值，计算衍生指标（如场均进球数），统计各队表现数据
2. **可视化视图选择**：
   - 时间趋势类：使用折线图展示进球数、观众人数、场均进球数等随时间的变化
   - 分类统计类：使用饼图、柱状图展示各洲、各队的统计数据
   - 排名对比类：使用条形图展示队伍排名情况
3. **交互设计**：使用pyecharts库实现交互式可视化，支持鼠标悬停查看详细数据、缩放、图例切换等交互功能

---

## 3 实验过程

### 3.1 数据预处理

#### （1）数据预处理设计
数据预处理主要包括以下几个方面：
- 缺失值处理：删除包含关键字段缺失的记录
- 数据计算：计算场均进球数等衍生指标
- 数据统计：统计各队进入前四名的次数、获得冠军的次数
- 数据分组：按大洲统计举办次数和冠军次数

#### （2）数据预处理的实现
```python
# 处理缺失值
summary_df = summary_df.dropna()  # 删除所有包含缺失值的行
matches_df = matches_df.dropna(subset=['Home Team Goals', 'Away Team Goals'])  # 只删除关键字段缺失的记录

# 计算场均进球数（衍生指标）
summary_df['AvgGoalsPerMatch'] = summary_df['GoalsScored'] / summary_df['MatchesPlayed']

# 统计各队进入前四名的次数（统计Winner、Second、Third、Fourth四个名次）
teams_top4 = []
for col in ['Winner', 'Second', 'Third', 'Fourth']:
    teams_top4.extend(summary_df[col].tolist())
team_top4_count = Counter(teams_top4)

# 统计各队获得冠军次数
champions = summary_df['Winner'].tolist()
champion_count = Counter(champions)

# 统计各洲举办次数
host_continent_count = summary_df['HostContinent'].value_counts().to_dict()

# 统计各洲获得冠军次数
winner_continent_count = summary_df['WinnerContinent'].value_counts().to_dict()
```

### 3.2 视图1：历届世界杯总进球数趋势

#### （1）设计思路及设计过程
该视图采用折线图展示1930-2018年共21届世界杯的总进球数变化趋势。折线图能够清晰地展现时间序列数据的变化规律，通过平滑曲线和标记点突出关键信息。

可视化元素：
- X轴：年份（1930-2018）
- Y轴：总进球数
- 折线：连接各届世界杯的进球数，使用平滑曲线
- 标记点：标注最大值和最小值

#### （2）交互设计
- 鼠标悬停：显示具体年份和进球数
- 图例交互：可点击图例显示/隐藏数据系列
- 数据缩放：支持鼠标滚轮缩放查看局部数据

#### （3）视图分析
从视图可以看出：
- 1930年首届世界杯总进球数为70个，1934年同样为70个
- 1954年瑞士世界杯进球数达到140个，创下当时的历史最高
- 1982年西班牙世界杯进球数达到146个，再次刷新纪录
- 1998年法国世界杯和2014年巴西世界杯总进球数均为171个，并列历史最高
- 最小值出现在1930年和1934年，均为70个
- 整体趋势显示，随着参赛队伍增加（从13支到32支）和比赛场次增多（从18场到64场），总进球数呈显著上升趋势

### 3.3 视图2：各洲举办世界杯次数

#### （1）设计思路及设计过程
该视图采用饼图展示各洲举办世界杯的次数分布。饼图能够直观地展示各部分占总体的比例关系，使用环形饼图增强视觉效果。

可视化元素：
- 饼图扇区：每个扇区代表一个大洲
- 扇区大小：与举办次数成正比
- 标签：显示大洲名称、次数和百分比

#### （2）交互设计
- 鼠标悬停：高亮显示对应扇区，显示详细信息
- 点击扇区：可突出显示该部分
- 图例交互：点击图例可显示/隐藏对应扇区

#### （3）视图分析
从视图可以看出：
- 欧洲举办世界杯次数最多，共11次，占比52.4%（11/21）
- 美洲（包括北美洲和南美洲）共举办8次，占比38.1%（8/21）
- 亚洲和非洲各举办1次，分别占比4.8%（1/21）
- 欧洲是世界杯的主要举办地，这与欧洲足球运动的传统优势和基础设施完善有关
- 美洲作为足球运动的另一大中心，也多次举办世界杯
- 亚洲和非洲各举办1次，体现了世界杯的全球化发展

### 3.4 视图3：各洲获得冠军次数

#### （1）设计思路及设计过程
该视图采用柱状图展示各洲获得世界杯冠军的次数。柱状图适合比较不同类别的数值大小，能够清晰地展现各洲的冠军数量差异。

可视化元素：
- X轴：大洲名称
- Y轴：冠军次数
- 柱状条：高度代表冠军次数，使用统一的颜色

#### （2）交互设计
- 鼠标悬停：显示大洲名称和具体冠军次数
- 数据标签：在柱状条顶部显示具体数值

#### （3）视图分析
从视图可以看出：
- 欧洲获得冠军次数最多，共12次，占比57.1%
- 美洲（主要是南美洲）获得9次冠军，占比42.9%
- 亚洲、非洲、大洋洲均未获得过世界杯冠军
- 欧洲和南美洲是世界杯冠军的主要获得者，体现了这两个地区在足球领域的统治地位

### 3.5 视图4：历届世界杯观众人数变化

#### （1）设计思路及设计过程
该视图采用折线图展示历届世界杯观众人数的变化趋势。通过面积填充和平均值标记线，突出显示观众人数的增长趋势和平均水平。

可视化元素：
- X轴：年份
- Y轴：观众人数（单位：万人）
- 折线：平滑曲线连接各届数据点
- 面积填充：在折线下方填充半透明区域
- 平均值线：标记平均观众人数

#### （2）交互设计
- 鼠标悬停：显示年份和观众人数（万人）
- 数据缩放：支持缩放查看不同时间段的数据

#### （3）视图分析
从视图可以看出：
- 1930年首届世界杯观众人数约59.1万人（590,549人），之后逐步增长
- 1950年巴西世界杯观众人数突破100万，达到104.5万人（1,045,246人），是首届世界杯的近1.8倍
- 1994年美国世界杯观众人数达到358.8万人（3,587,538人），创历史新高
- 2014年巴西世界杯观众人数达到338.7万人（3,386,810人），位居第二
- 2006年德国世界杯观众人数达到335.9万人（3,359,439人），位居第三
- 整体趋势显示，随着世界杯影响力的扩大、体育场容量的增加以及比赛场次的增多，观众人数呈显著上升趋势

### 3.6 视图5：参赛队伍数量变化

#### （1）设计思路及设计过程
该视图采用柱状图展示历届世界杯参赛队伍数量的变化。通过柱状图可以清晰地看到参赛队伍数量的阶段性变化，特别是扩军的重要节点。

可视化元素：
- X轴：年份
- Y轴：参赛队伍数
- 柱状条：高度代表队伍数量
- 数据缩放条：支持横向滚动查看所有年份

#### （2）交互设计
- 鼠标悬停：显示年份和队伍数量
- 数据缩放：底部提供滑动条，可缩放查看不同时间段
- 数据标签：在柱状条顶部显示具体数值

#### （3）视图分析
从视图可以看出：
- 1930-1978年：参赛队伍稳定在13-16支
- 1982年：首次扩军至24支队伍
- 1998年：扩军至32支队伍，并保持至今
- 参赛队伍数量的增加反映了世界杯的国际化程度不断提高，更多国家和地区参与到这一顶级赛事中

### 3.7 视图6：各队进入前四名次数（Top 10）

#### （1）设计思路及设计过程
该视图采用横向条形图展示进入前四名次数最多的10支队伍。横向条形图适合展示排名数据，便于阅读队伍名称。

可视化元素：
- Y轴：队伍名称（Top 10）
- X轴：进入前四名的次数
- 条形：长度代表次数，使用暖色调

#### （2）交互设计
- 鼠标悬停：显示队伍名称和具体次数
- 数据标签：在条形右侧显示具体数值

#### （3）视图分析
从视图可以看出（统计Winner、Second、Third、Fourth四个名次）：
- 德国（包括前西德）进入前四名次数最多，共13次，展现了其强大的足球传统和稳定性
- 巴西紧随其后，共11次，是南美洲进入前四名次数最多的队伍
- 意大利、阿根廷、法国、荷兰等传统强队也多次进入前四名
- 这10支队伍都是世界杯历史上的传统强队，展现了它们在世界杯舞台上的稳定表现和强大实力
- 进入前四名次数的统计反映了各队在世界杯历史上的整体竞争力

### 3.8 视图7：历届世界杯场均进球数

#### （1）设计思路及设计过程
该视图采用折线图展示历届世界杯场均进球数的变化。通过面积填充和平均值标记线，分析比赛进攻性的变化趋势。

可视化元素：
- X轴：年份
- Y轴：场均进球数
- 折线：平滑曲线
- 面积填充：半透明区域突出趋势
- 平均值线：标记历史平均场均进球数

#### （2）交互设计
- 鼠标悬停：显示年份和场均进球数
- 图例交互：可控制显示/隐藏

#### （3）视图分析
从视图可以看出（场均进球数 = 总进球数 / 比赛场次）：
- 1954年瑞士世界杯场均进球数最高，达到5.38个（140球/26场），反映了当时足球战术以进攻为主的特点
- 1930-1954年期间，场均进球数波动较大，在3.89-5.38个之间
- 1958年之后，场均进球数趋于稳定，大多在2.5-3.5个之间
- 最小值出现在1990年意大利世界杯，场均进球数为2.21个（115球/52场），反映了防守足球的盛行
- 整体来看，现代世界杯的场均进球数相对稳定在2.5-3.5个之间，反映了足球战术的发展和防守水平的提高，以及攻守平衡的重要性

### 3.9 视图8：各队获得冠军次数

#### （1）设计思路及设计过程
该视图采用柱状图展示所有获得过世界杯冠军的队伍及其夺冠次数。通过柱状图可以清晰地比较各队的夺冠次数，展现世界杯历史上的强队格局。

可视化元素：
- X轴：队伍名称
- Y轴：冠军次数
- 柱状条：高度代表夺冠次数，使用红色系突出重要性
- 标签旋转：X轴标签旋转45度便于阅读

#### （2）交互设计
- 鼠标悬停：显示队伍名称和夺冠次数
- 数据标签：在柱状条顶部显示具体数值

#### （3）视图分析
从视图可以看出（统计1930-2018年共21届世界杯）：
- 巴西获得5次冠军（1958、1962、1970、1994、2002），是获得世界杯冠军最多的国家，被誉为"足球王国"
- 德国（包括前西德）获得4次冠军（1954、1974、1990、2014），展现了德国足球的强大实力
- 意大利获得4次冠军（1934、1938、1982、2006），是欧洲获得冠军次数最多的国家之一
- 阿根廷获得2次冠军（1978、1986），是南美洲仅次于巴西的强队
- 法国获得2次冠军（1998、2018），是近年来表现突出的欧洲强队
- 乌拉圭获得2次冠军（1930、1950），是首届世界杯的冠军
- 英格兰获得1次冠军（1966），是唯一一次在本土夺冠
- 西班牙获得1次冠军（2010），是2010年南非世界杯的冠军
- 共有8支不同的队伍获得过世界杯冠军，展现了世界杯的竞争激烈程度和足球运动的全球化发展

---

## 4 设计总结与心得

### 4.1 实验总结

#### 4.1.1 遇到的问题及处理

1. **数据缺失值处理**
   - 问题：部分比赛数据中存在缺失值，影响统计准确性
   - 处理：使用pandas的dropna()方法删除关键字段缺失的记录，确保数据质量。对于summary_df删除所有包含缺失值的行，对于matches_df只删除关键字段（Home Team Goals、Away Team Goals）缺失的记录

2. **折线图数据格式问题**
   - 问题：初始生成的折线图没有显示数据，原因是x轴类型与数据格式不匹配
   - 处理：将年份数据转换为字符串格式，明确设置x轴类型为category，并设置合适的显示间隔（interval=2），确保折线图能正确显示数据

3. **年份显示间隔问题**
   - 问题：横坐标年份显示过于密集，影响可读性
   - 处理：在axislabel_opts中设置interval参数为2，表示每隔2个年份显示一次标签，既保证了数据的完整性，又提高了可读性

4. **中文显示问题**
   - 问题：pyecharts默认字体不支持中文显示
   - 处理：使用pyecharts的主题配置（ThemeType.MACARONS）和自定义字体设置，确保中文标签正常显示

5. **数据统计复杂性**
   - 问题：需要统计各队进入前四名的次数，涉及多个字段
   - 处理：使用循环遍历Winner、Second、Third、Fourth四个字段，将所有队伍名称合并到列表中，使用Counter进行统计，然后排序取前10名

6. **可视化视图选择**
   - 问题：如何选择合适的图表类型表达不同的数据特征
   - 处理：时间序列数据使用折线图，分类数据使用饼图或柱状图，排名数据使用条形图。根据数据特点选择合适的视觉通道，如使用渐变色彩、面积填充等增强视觉效果

#### 4.1.2 设计方案存在的不足

1. **数据维度有限**：本次实验主要使用了WorldCupsSummary.csv汇总数据，对WorldCupMatches.csv和WorldCupPlayers.csv的利用不够充分，可以进一步分析单场比赛的详细数据和球员表现。

2. **地理可视化缺失**：虽然分析了各洲的数据，但没有使用地图可视化展示世界杯的地理分布，可以增加地理坐标系视图。

3. **交互功能可以更丰富**：当前视图主要支持基本的悬停和缩放，可以增加更多交互功能，如数据筛选、时间范围选择等。

4. **数据关联分析不足**：各视图相对独立，可以增加视图间的关联分析，如分析主办国与冠军的关系、观众人数与比赛精彩程度的关系等。

### 4.2 实验心得

通过本次数据可视化实验，我深入了解了数据可视化的设计方法和实现过程。主要收获如下：

1. **数据预处理的重要性**：数据预处理是可视化成功的基础，只有处理好数据，才能准确展现数据的故事。在实验过程中，我学会了如何处理缺失值、计算衍生指标（如场均进球数）、进行数据统计等预处理操作。特别是使用Counter统计各队进入前四名的次数，让我理解了如何从多个维度提取有效信息。

2. **可视化视图的选择**：不同的数据特征需要选择不同的可视化方式。时间序列数据适合用折线图，分类数据适合用饼图或柱状图，排名数据适合用条形图。选择合适的图表类型能够更好地传达信息。例如，使用横向条形图展示排名数据，便于阅读队伍名称。

3. **数据格式与图表配置的匹配**：在实现折线图时，遇到了数据格式与x轴类型不匹配的问题。通过将年份转换为字符串格式，明确设置x轴类型为category，解决了数据不显示的问题。这让我认识到数据格式与图表配置的匹配至关重要。

4. **交互设计提升用户体验**：使用pyecharts库实现的交互式可视化，让用户可以通过鼠标悬停、缩放、图例切换等方式探索数据，大大提升了用户体验。通过添加标记点（最大值、最小值）、标记线（平均值）等元素，增强了图表的可读性和信息量。

5. **视觉设计的重要性**：通过使用现代配色方案、渐变色彩、面积填充、圆角设计等视觉元素，让图表更加美观和专业。合理的颜色搭配和视觉层次能够引导用户关注重要信息。

6. **讲述数据的故事**：数据可视化不仅仅是展示数据，更重要的是通过可视化讲述数据背后的故事。通过8个不同的视图，我从多个角度展现了世界杯88年来的发展历程，包括进球趋势、观众增长、队伍实力变化、国际化发展等。每个视图都揭示了数据背后的深层含义。

7. **技术实践能力**：通过实际编写代码，我熟悉了pandas数据处理和pyecharts可视化库的使用，提升了编程实践能力。学会了如何组织代码结构，使用函数封装通用配置，提高代码的可维护性和可读性。

### 4.3 意见与建议

1. **数据集建议**：建议提供更多样化的数据集，包括不同领域的数据，让学生有更多选择。

2. **工具库建议**：建议在实验要求中明确推荐使用的可视化库，避免学生在库的选择上花费过多时间。

3. **评价标准建议**：建议在评价标准中更加明确"讲述数据的故事"的具体要求，帮助学生更好地理解实验目标。

4. **实验指导建议**：建议提供一些可视化设计的参考案例，帮助学生理解如何设计合理的可视化方案。

---

## 附录一 实验代码

（见experiment.py文件）

---

## 最终提交的文件

（1）实验代码[电子版]：experiment.py
（2）可视化视图[电子版]：view1_goals_trend.html 至 view8_champions.html（共8个HTML文件）
（3）实验报告[电子版]：本报告
（4）实验报告[纸质版]：待打印提交

